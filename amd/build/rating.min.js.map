{"version":3,"sources":["../src/rating.js"],"names":["define","keys","Rating","questionDiv","clearButton","querySelector","addEventListener","e","preventDefault","clearRating","blur","keyCode","enter","space","radios","querySelectorAll","stars","forEach","star","index","checked","radio","init","questionId","M","util","js_pending","document","getElementById","js_complete"],"mappings":"AAuBAA,OAAM,gCAAC,CAAC,gBAAD,CAAD,CAAqB,SAASC,CAAT,CAAe,CAMtC,QAASC,CAAAA,CAAT,CAAgBC,CAAhB,CAA6B,CACzB,GAAIC,CAAAA,CAAW,CAAGD,CAAW,CAACE,aAAZ,CAA0B,mCAA1B,CAAlB,CACAD,CAAW,CAACE,gBAAZ,CAA6B,OAA7B,CA2BA,SAA2BC,CAA3B,CAA8B,CAC1BA,CAAC,CAACC,cAAF,GACAC,CAAW,CAACN,CAAD,CAAX,CACAC,CAAW,CAACM,IAAZ,EACH,CA/BD,EACAN,CAAW,CAACE,gBAAZ,CAA6B,SAA7B,CAqCA,SAA8BC,CAA9B,CAAiC,CAC7B,OAAQA,CAAC,CAACI,OAAV,EACI,IAAKV,CAAAA,CAAI,CAACW,KAAV,CACA,IAAKX,CAAAA,CAAI,CAACY,KAAV,CACIN,CAAC,CAACC,cAAF,GACAC,CAAW,CAACN,CAAD,CAAX,CACAC,CAAW,CAACM,IAAZ,GACA,OAEJ,QARJ,CAWH,CAjDD,EAHyB,GAKrBI,CAAAA,CAAM,CAAGX,CAAW,CAACY,gBAAZ,CAA6B,kCAA7B,CALY,CAMrBC,CAAK,CAAGb,CAAW,CAACY,gBAAZ,CAA6B,sBAA7B,CANa,CAOzBC,CAAK,CAACC,OAAN,CAAc,SAASC,CAAT,CAAeC,CAAf,CAAsB,CAChCD,CAAI,CAACZ,gBAAL,CAAsB,SAAtB,CAAiC,SAASC,CAAT,CAAY,CACzC,OAAQA,CAAC,CAACI,OAAV,EACI,IAAKV,CAAAA,CAAI,CAACW,KAAV,CACA,IAAKX,CAAAA,CAAI,CAACY,KAAV,CACIN,CAAC,CAACC,cAAF,GAGAM,CAAM,CAACK,CAAK,CAAG,CAAT,CAAN,CAAkBC,OAAlB,CAA4B,CAACN,CAAM,CAACK,CAAK,CAAG,CAAT,CAAN,CAAkBC,OAA/C,CACA,OAEJ,QATJ,CAYH,CAbD,CAcH,CAfD,EAoDA,QAASX,CAAAA,CAAT,CAAqBN,CAArB,CAAkC,CAC9B,GAAIW,CAAAA,CAAM,CAAGX,CAAW,CAACY,gBAAZ,CAA6B,kCAA7B,CAAb,CACAD,CAAM,CAACG,OAAP,CAAe,SAASI,CAAT,CAAgBF,CAAhB,CAAuB,CAClC,GAAc,CAAV,GAAAA,CAAJ,CAAiB,CACbE,CAAK,CAACD,OAAN,GACH,CAFD,IAEO,IAAI,KAAAC,CAAK,CAACD,OAAV,CAA4B,CAC/BC,CAAK,CAACD,OAAN,GACH,CACJ,CAND,CAOH,CACJ,CAED,MAAO,CAMHE,IAAI,CAAE,cAASC,CAAT,CAAqB,CACvBC,CAAC,CAACC,IAAF,CAAOC,UAAP,CAAkB,UAAYH,CAA9B,EACA,GAAIpB,CAAAA,CAAW,CAAGwB,QAAQ,CAACC,cAAT,CAAwBL,CAAxB,CAAlB,CACA,GAAIrB,CAAAA,CAAJ,CAAWC,CAAX,EACAqB,CAAC,CAACC,IAAF,CAAOI,WAAP,CAAmB,UAAYN,CAA/B,CACH,CAXE,CAaV,CA1FK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n//\n\n/**\n * JavaScript for rating.\n *\n * @package    qbehaviour_selfassess\n * @copyright  2020 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/key_codes'], function(keys) {\n    /**\n     * Rating object.\n     * @param {Element} questionDiv\n     * @constructor\n     */\n    function Rating(questionDiv) {\n        let clearButton = questionDiv.querySelector('.rating .stars input[type=button]');\n        clearButton.addEventListener('click', handleButtonClick);\n        clearButton.addEventListener('keydown', handleButtonKeyPress);\n\n        let radios = questionDiv.querySelectorAll('.rating .stars input[type=radio]');\n        let stars = questionDiv.querySelectorAll('.rating .stars label');\n        stars.forEach(function(star, index) {\n            star.addEventListener('keydown', function(e) {\n                switch (e.keyCode) {\n                    case keys.enter:\n                    case keys.space:\n                        e.preventDefault();\n                        // Using index+1, because the radio button starting from 0 and labels (stars) starting with 1.\n                        // Reverse the boolean value as a shortcat instead of an if-statement.\n                        radios[index + 1].checked = !radios[index + 1].checked;\n                        return;\n\n                    default:\n                        return;\n                }\n            });\n        });\n\n        /**\n         * Handles clicks on the clear button.\n         *\n         * @param {Event} e\n         */\n        function handleButtonClick(e) {\n            e.preventDefault();\n            clearRating(questionDiv);\n            clearButton.blur();\n        }\n\n        /**\n         * Handles keydown on the clear button.\n         *\n         * @param {KeyboardEvent} e\n         */\n        function handleButtonKeyPress(e) {\n            switch (e.keyCode) {\n                case keys.enter:\n                case keys.space:\n                    e.preventDefault();\n                    clearRating(questionDiv);\n                    clearButton.blur();\n                    return;\n\n                default:\n                    return;\n            }\n        }\n\n        /**\n         * Clear rating and set the rating to not rated.\n         *\n         * @param {Element} questionDiv\n         */\n        function clearRating(questionDiv) {\n            let radios = questionDiv.querySelectorAll('.rating .stars input[type=radio]');\n            radios.forEach(function(radio, index) {\n                if (index === 0) {\n                    radio.checked = true;\n                } else if (radio.checked === true) {\n                    radio.checked = false;\n                }\n            });\n        }\n    }\n\n    return {\n        /**\n         * Initialise star rating for self-assess question behaviour.\n         *\n         * @param {string} questionId id of the outer question div\n         */\n        init: function(questionId) {\n            M.util.js_pending('rating-' + questionId);\n            let questionDiv = document.getElementById(questionId);\n            new Rating(questionDiv);\n            M.util.js_complete('rating-' + questionId);\n        }\n    };\n});\n"],"file":"rating.min.js"}